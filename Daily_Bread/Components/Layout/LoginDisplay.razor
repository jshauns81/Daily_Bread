@inject NavigationManager Navigation

<AuthorizeView>
    <Authorized>
        <div class="login-display-container">
            <div class="user-dropdown">
                <button class="btn-user-menu" @onclick="ToggleDropdown" @onclick:stopPropagation="true">
                    <span class="bi bi-person-circle me-1"></span>
                    <span class="user-name">@context.User.Identity?.Name</span>
                    <span class="bi bi-chevron-down ms-1 dropdown-chevron"></span>
                </button>
                
                @if (_showDropdown)
                {
                    <div class="user-dropdown-menu">
                        <a href="/account/change-password" class="dropdown-item">
                            <span class="bi bi-key me-2"></span> Change Password
                        </a>
                        <hr class="dropdown-divider" />
                        <form method="post" action="/Account/Logout" @formname="logout-form">
                            <AntiforgeryToken />
                            <button type="submit" class="dropdown-item text-danger">
                                <span class="bi bi-box-arrow-right me-2"></span> Logout
                            </button>
                        </form>
                    </div>
                }
            </div>
        </div>
        
        @if (_showDropdown)
        {
            <div class="dropdown-backdrop" @onclick="CloseDropdown"></div>
        }
    </Authorized>
    <NotAuthorized>
        <a href="/Account/Login" class="btn-auth">
            <span class="bi bi-box-arrow-in-right me-1"></span> Login
        </a>
    </NotAuthorized>
</AuthorizeView>

@code {
    private bool _showDropdown = false;

    private void ToggleDropdown()
    {
        _showDropdown = !_showDropdown;
    }

    private void CloseDropdown()
    {
        _showDropdown = false;
    }
}

<style>
    .login-display-container {
        display: flex;
        align-items: center;
        gap: 1rem;
        background: transparent;
        position: relative;
    }
    
    .user-dropdown {
        position: relative;
    }
    
    .btn-user-menu {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        background-color: transparent;
        color: var(--nord4);
        border: 1px solid var(--nord3);
        border-radius: 6px;
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.15s ease;
        cursor: pointer;
    }
    
    .btn-user-menu:hover {
        background-color: var(--nord2);
        color: var(--nord6);
    }
    
    .user-name {
        max-width: 120px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .dropdown-chevron {
        font-size: 0.7rem;
        opacity: 0.7;
    }
    
    .user-dropdown-menu {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 0.5rem;
        background-color: var(--nord1);
        border: 1px solid var(--nord3);
        border-radius: 8px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        min-width: 180px;
        z-index: 1050;
        overflow: hidden;
    }
    
    .user-dropdown-menu .dropdown-item {
        display: flex;
        align-items: center;
        padding: 0.6rem 1rem;
        color: var(--nord6);
        text-decoration: none;
        background: transparent;
        border: none;
        width: 100%;
        text-align: left;
        font-size: 0.875rem;
        cursor: pointer;
        transition: background-color 0.15s ease;
    }
    
    .user-dropdown-menu .dropdown-item:hover {
        background-color: var(--nord2);
    }
    
    .user-dropdown-menu .dropdown-item.text-danger {
        color: var(--nord11);
    }
    
    .user-dropdown-menu .dropdown-item.text-danger:hover {
        background-color: rgba(191, 97, 106, 0.15);
    }
    
    .user-dropdown-menu .dropdown-divider {
        border-color: var(--nord3);
        margin: 0.25rem 0;
    }
    
    .user-dropdown-menu form {
        margin: 0;
        padding: 0;
    }
    
    .dropdown-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1040;
    }
    
    /* Legacy button style for login */
    .btn-auth {
        background-color: transparent;
        color: var(--nord4);
        border: 1px solid var(--nord3);
        border-radius: 6px;
        padding: 0.375rem 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.15s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        white-space: nowrap;
        line-height: 1.4;
    }
    
    .btn-auth:hover {
        background-color: var(--nord10);
        border-color: var(--nord10);
        color: var(--nord6);
    }
</style>
