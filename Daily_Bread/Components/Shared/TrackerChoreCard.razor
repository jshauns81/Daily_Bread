@namespace Daily_Bread.Components.Shared
@using Daily_Bread.Data.Models
@using Daily_Bread.Helpers
@using Daily_Bread.Services

<div class="tracker-card @ChoreDisplayHelper.GetCardClass(Item.Status)">
    @* Status Indicator - aligned with SwipeableChoreCard pattern *@
    <div class="card-indicator">
        <button class="status-button @ChoreDisplayHelper.GetCheckboxClass(Item.Status, Item.IsCompleted)"
                disabled="@IsDisabled"
                @onclick="OnToggleClicked"
                title="@GetTooltip()">
            <span class="bi @GetIndicatorIcon()"></span>
        </button>
    </div>
    
    @* Card Content - matching SwipeableChoreCard structure *@
    <div class="card-content">
        <div class="chore-info">
            <span class="chore-name @(Item.IsApproved ? "strikethrough" : "")">
                @Item.ChoreName
            </span>
            <div class="chore-meta">
                @if (ShowAssignee && !string.IsNullOrEmpty(Item.AssignedUserName))
                {
                    <span class="user-name">@Item.AssignedUserName</span>
                }
                <span class="status-text">@ChoreDisplayHelper.GetStatusDisplay(Item.Status)</span>
            </div>
        </div>
    </div>
    
    @* Value display - aligned with SwipeableChoreCard *@
    <div class="chore-value">
        <span class="value-amount @(Item.IsMissed ? "negative" : "")">
            @(Item.IsMissed ? "-" : "")$@Item.Value.ToString("F2")
        </span>
        @if (ShowActions)
        {
            <div class="card-actions">
                @switch (Item.Status)
                {
                    case ChoreStatus.Completed:
                        <button class="action-btn approve" @onclick="OnApproveClicked" title="Bless this labor">
                            <span class="bi bi-check2-circle"></span>
                        </button>
                        break;
                        
                    case ChoreStatus.Help:
                        <button class="action-btn help" @onclick="OnRespondToHelpClicked" title="Respond to help request">
                            <span class="bi bi-chat-heart"></span>
                        </button>
                        break;
                        
                    case ChoreStatus.Pending:
                        <button class="action-btn muted" @onclick="OnSkipClicked" title="Excuse for today">
                            <span class="bi bi-dash-circle"></span>
                        </button>
                        break;
                        
                    case ChoreStatus.Approved:
                    case ChoreStatus.Missed:
                    case ChoreStatus.Skipped:
                        <button class="action-btn muted" @onclick="OnResetClicked" title="Restore">
                            <span class="bi bi-arrow-counterclockwise"></span>
                        </button>
                        break;
                }
            </div>
        }
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public required TrackerChoreItem Item { get; set; }

    [Parameter]
    public bool IsDisabled { get; set; }

    [Parameter]
    public bool ShowAssignee { get; set; }

    [Parameter]
    public bool ShowActions { get; set; }

    [Parameter]
    public EventCallback<TrackerChoreItem> OnToggle { get; set; }

    [Parameter]
    public EventCallback<TrackerChoreItem> OnApprove { get; set; }

    [Parameter]
    public EventCallback<TrackerChoreItem> OnSkip { get; set; }
    
    [Parameter]
    public EventCallback<TrackerChoreItem> OnReset { get; set; }
    
    [Parameter]
    public EventCallback<TrackerChoreItem> OnRespondToHelp { get; set; }

    private string GetIndicatorIcon() => Item.Status switch
    {
        ChoreStatus.Approved => "bi-check-circle-fill",
        ChoreStatus.Completed => "bi-check-lg",
        ChoreStatus.Help => "bi-question-circle-fill",
        ChoreStatus.Missed => "bi-x-circle",
        ChoreStatus.Skipped => "bi-dash-circle",
        _ => "bi-circle"
    };

    private string GetTooltip() => Item.Status switch
    {
        ChoreStatus.Approved => "Blessed",
        ChoreStatus.Completed => "Done - awaiting blessing",
        ChoreStatus.Help => "Help requested",
        ChoreStatus.Missed => "Not completed",
        ChoreStatus.Skipped => "Excused",
        _ => "Mark as done"
    };

    private async Task OnToggleClicked() => await OnToggle.InvokeAsync(Item);
    private async Task OnApproveClicked() => await OnApprove.InvokeAsync(Item);
    private async Task OnSkipClicked() => await OnSkip.InvokeAsync(Item);
    private async Task OnResetClicked() => await OnReset.InvokeAsync(Item);
    private async Task OnRespondToHelpClicked() => await OnRespondToHelp.InvokeAsync(Item);
}
