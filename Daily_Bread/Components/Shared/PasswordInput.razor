@namespace Daily_Bread.Components.Shared
@using System.Linq.Expressions

<div class="password-input-wrapper">
    <div class="input-group">
        <InputText type="@(_showPassword ? "text" : "password")" 
                   Value="@Value"
                   ValueChanged="ValueChanged"
                   ValueExpression="ValueExpression"
                   id="@InputId"
                   class="nord-input" 
                   placeholder="@Placeholder"
                   autocomplete="@Autocomplete"
                   autocapitalize="off"
                   autocorrect="off"
                   spellcheck="false"
                   aria-required="@Required.ToString().ToLower()"
                   disabled="@Disabled" />
        <button type="button" 
                class="password-toggle" 
                tabindex="-1"
                @onclick="TogglePasswordVisibility"
                aria-label="@(_showPassword ? "Hide password" : "Show password")"
                title="@(_showPassword ? "Hide password" : "Show password")">
            <span class="bi @(_showPassword ? "bi-eye-slash" : "bi-eye")"></span>
        </button>
    </div>
    @if (!string.IsNullOrEmpty(HelpText))
    {
        <small class="text-muted">@HelpText</small>
    }
</div>

@code {
    [Parameter]
    public string? Value { get; set; }

    [Parameter]
    public EventCallback<string?> ValueChanged { get; set; }

    [Parameter]
    public Expression<Func<string?>>? ValueExpression { get; set; }

    [Parameter]
    public string Placeholder { get; set; } = "Enter password";

    [Parameter]
    public string Autocomplete { get; set; } = "current-password";

    [Parameter]
    public bool Required { get; set; } = true;

    [Parameter]
    public bool Disabled { get; set; } = false;

    [Parameter]
    public string HelpText { get; set; } = "";

    [Parameter]
    public string InputId { get; set; } = "";

    private bool _showPassword = false;

    private void TogglePasswordVisibility()
    {
        _showPassword = !_showPassword;
    }
}
