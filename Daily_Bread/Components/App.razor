<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#2E3440" />
    <base href="/" />
    
    <!-- Critical CSS to prevent flash -->
    <style>
        /* Inline critical styles to prevent FOUC */
        html, body {
            background-color: #2E3440;
            color: #ECEFF4;
            margin: 0;
            padding: 0;
        }
        
        /* Hide content until Blazor is ready */
        .page-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #2E3440;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease-out;
        }
        
        .page-loading.loaded {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #3B4252;
            border-top-color: #88C0D0;
            border-radius: 50%;
            animation: page-loading-spin 0.8s linear infinite;
        }
        
        @@keyframes page-loading-spin {
            to { transform: rotate(360deg); }
        }
        
        /* Prevent layout shift during hydration */
        [b-*] { visibility: visible !important; }
    </style>
    
    <!-- Google Fonts - Inter for modern typography + Noto Color Emoji for emoji support -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="lib/bootstrap-icons/font/bootstrap-icons.min.css" />
    
    <ResourcePreloader />
    <link rel="stylesheet" href="@Assets["lib/bootstrap/dist/css/bootstrap.min.css"]" />
    <link rel="stylesheet" href="@Assets["app.css"]" />
    <link rel="stylesheet" href="@Assets["Daily_Bread.styles.css"]" />
    <ImportMap />
    <link rel="icon" type="image/png" href="images/bread-icon.png" />
    <link rel="apple-touch-icon" href="images/bread-icon.png" />
    <HeadOutlet />
</head>

<body>
    <!-- Initial loading overlay -->
    <div id="page-loading" class="page-loading">
        <div class="loading-spinner"></div>
    </div>

    <CascadingAuthenticationState>
        <Routes />
    </CascadingAuthenticationState>
    <ReconnectModal />
    <script src="@Assets["_framework/blazor.web.js"]"></script>
    <script>
        // Hide loading overlay once Blazor is ready
        Blazor.addEventListener('enhancedload', function() {
            var loader = document.getElementById('page-loading');
            if (loader) {
                loader.classList.add('loaded');
                setTimeout(function() { loader.remove(); }, 300);
            }
        });
        
        // Fallback: hide after initial render
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                var loader = document.getElementById('page-loading');
                if (loader && !loader.classList.contains('loaded')) {
                    loader.classList.add('loaded');
                    setTimeout(function() { loader.remove(); }, 300);
                }
            }, 100);
        });
    </script>
</body>

</html>
